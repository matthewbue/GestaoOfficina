<!--------------------------------------------------CRIAR-ORÇAMENTO------------------------------------------------------->
<div *ngIf=" tipo != 'visualizar' && tipo != 'editar'">
  <section>
    <div class="col-12">
      <div class="content-header">
        <h1>Cadastro de orçamento</h1>
      </div>
    </div>
    <div class="card">
      <div class="card-content">
        <div class="card-body">
          <div class="row" id="cliente-cadastro">
            <div class="col-12" id="cliente-info">
              <h2>Dados do Cliente</h2>
              <form [formGroup]="formCliente" novalidate>
                <div class="form-row">
                  <div class="col-md-3">
                    <div class="form-group">
                      <label for="nome">Nome:</label>
                      <input maxlength="100" id="nome" type="text" class="form-control" value=" {{ cliente.nome }} "
                        disabled />
                    </div>
                  </div>
                  <div class="col-md-3">
                    <div class="form-group">
                      <label for="cpfcnpj">CPF / CNPJ:</label>
                      <input maxlength="100" id="cpf" type="text" class="form-control" formControlName="cpf"
                        value=" {{ cliente.cpf }} " disabled />
                    </div>
                  </div>
                  <div class="col-md-3">
                    <div class="form-group">
                      <label for="endereco">Endereço(Rua):</label>
                      <input maxlength="100" id="endereco" type="text" class="form-control" formControlName="endereco"
                        value=" {{ cliente.endereco }} " disabled />
                    </div>
                  </div>

                  <div class="col-md-3">
                    <div class="form-group">
                      <label for="bairro">Bairro:</label>
                      <input maxlength="100" id="bairro" type="text" class="form-control" formControlName="bairro"
                        value=" {{ cliente.bairro }} " disabled />
                    </div>
                  </div>

                  <div class="col-md-3">
                    <div class="form-group">
                      <label for="numeroWhatsapp">Número Whatsapp:</label>
                      <input maxlength="100" id="numeroWhatsapp" name="numeroWhatsapp" type="text" class="form-control"
                        formControlName="numeroWhatsapp" value=" {{ cliente.numeroWhatsapp }} " disabled />
                    </div>
                  </div>

                  <div class="col-md-3">
                    <div class="form-group">
                      <label for="numeroContato">Telefone para contato:</label>
                      <input maxlength="100" id="numeroContato" name="numeroContato" type="text" class="form-control"
                        formControlName="numeroContato" value=" {{ cliente.numeroContato }} " disabled />
                    </div>
                  </div>
                  <div class="col-md-3">
                    <div class="form-group">
                      <label for="email">E-mail:</label>
                      <input maxlength="100" id="email" name="email" type="text" class="form-control"
                        formControlName="email" value=" {{ cliente.email }} " disabled />
                    </div>
                  </div>
                  <div class="col-md-3">
                    <div class="form-group">
                      <label for="marca">Veículo:</label>
                      <ng-select [(ngModel)]="marcaSelecionada" (change)="onSelectMarca($event)">
                        <ng-option *ngFor="let automovel of cliente.automoveis" [value]="automovel.marca">
                          {{ automovel.marca }}
                        </ng-option>
                      </ng-select>
                    </div>
                  </div>
                </div>
              </form>
            </div>
          </div>
          <form [formGroup]="formVeiculo" novalidate>
            <div class="row">
              <div class="col-md-3">
                <div class="form-group">
                  <label for="placa">Placa:</label>
                  <input maxlength="100" id="placa" name="placa" type="text" class="form-control"
                    formControlName="placa" disabled />
                </div>
              </div>
              <div class="col-md-3">
                <div class="form-group">
                  <label for="cor">Cor:</label>
                  <input maxlength="100" id="cor" name="cor" type="text" class="form-control" formControlName="cor"
                    disabled />
                </div>
              </div>
              <div class="col-md-3">
                <div class="form-group">
                  <label for="ano">Ano:</label>
                  <input maxlength="100" id="ano" name="ano" type="text" class="form-control" formControlName="ano"
                    disabled />
                </div>
              </div>
              <div class="col-md-3">
                <div class="form-group">
                  <label for="modelo">Modelo:</label>
                  <input maxlength="100" id="modelo" name="modelo" type="text" class="form-control"
                    formControlName="modelo" disabled />
                </div>
              </div>
            </div>
            <div class="row">
              <div class="col-md-3">
                <div class="form-group">
                  <label for="km">KM:</label>
                  <input maxlength="100" id="km" name="km" type="text" class="form-control" formControlName="km"
                    disabled />
                </div>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>
  </section>
  <section>
    <div class="card">
      <div class="card-content">
        <div class="card-body">
          <div class="row" id="ordem-servico-cadastro">

            <div class="col-md-12 mt-4">
              <h3>Adicionar Serviços</h3>
              <div class="col-md-3">
              </div>
              <div class="row">
                <!-- <div class="col-md-6">
                  <label for="servico">Serviço:</label>
                  <ng-select (change)="onSelectServico($event)">
                    <ng-option *ngFor="let listServicos of servicosList" [value]="listServicos.descricao">
                      {{ listServicos.descricao }}
                    </ng-option>
                  </ng-select>
                </div> -->
                <div class="col-md-6">
                  <div class="form-group">
                    <label for="servico">Serviço:</label>
                    <input maxlength="100" id="servico" type="text" class="form-control" [(ngModel)]="novoServico" />
                  </div>
                </div>
                <div class="col-md-3 align-self-end">
                  <div class="form-group">
                    <label for="valorServico">Valor do Serviço (R$):</label>
                    <div class="input-group">
                      <div class="input-group-prepend">
                        <span class="input-group-text">R$</span>
                      </div>
                      <input maxlength="100" id="valorServico" type="number" class="form-control"
                        [(ngModel)]="novoValor" />
                    </div>
                  </div>
                </div>
                <div class="col-md-1 align-self-end">
                  <div class="form-group">
                    <button type="button" class="btn btn-success mt-md-4" (click)="adicionarServico()">+</button>
                  </div>
                </div>
              </div>

            </div>
            <div class="col-md-12 mt-4">
              <h3>Lista de Serviços</h3>
              <table class="table table-bordered">
                <thead>
                  <tr>
                    <th>Serviço</th>
                    <th>Valor (R$)</th>
                    <th>Km do Serviço</th>
                    <th>Média/dia</th>
                    <th>Ações</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let servico of servicos">
                    <td>
                      <ng-container *ngIf="servicoEditando !== servico; else editarNome">
                        {{ servico.nome }}
                      </ng-container>
                      <ng-template #editarNome>
                        <input maxlength="100" type="text" class="form-control col-md-6"
                          [(ngModel)]="servicoEditandoTemp.nome" />
                      </ng-template>
                    </td>
                    <td>
                      <ng-container *ngIf="servicoEditando !== servico; else editarValor">
                        {{ servico.valor }},00
                      </ng-container>
                      <ng-template #editarValor>
                        <input maxlength="100" type="text" class="form-control col-md-6"
                          [(ngModel)]="servicoEditandoTemp.valor" />
                      </ng-template>
                    </td>
                    <td>
                      <div class="form-group">
                        <input maxlength="100" type="text" class="form-control col-md-6"
                          [(ngModel)]="servico.kmServico" />
                      </div>
                    </td>
                    <td>
                      <div class="form-group">
                        <input maxlength="100" type="text" class="form-control col-md-6"
                          [(ngModel)]="servico.mediaKm" />
                      </div>
                    </td>
                    <td>
                      <ng-container *ngIf="servicoEditando !== servico; else botoesEdicao">
                        <button type="button" class="btn btn-danger btn-sm"
                          (click)="removerServico(servico)">Remover</button>
                        <!-- <button type="button" class="btn btn-warning btn-sm"
                          (click)="editarServico(servico)">Editar</button> -->
                      </ng-container>
                      <ng-template #botoesEdicao>
                        <button type="button" class="btn btn-success btn-sm"
                          (click)="atualizarServico(servico)">Atualizar</button>
                        <button type="button" class="btn btn-danger btn-sm"
                          (click)="cancelarEdicao(servico)">Cancelar</button>
                      </ng-template>
                    </td>
                  </tr>
                </tbody>

              </table>
            </div>

            <div class="col-md-4 mt-4">
              <div class="form-group">
                <label for="valorTotal">Valor Total (R$):</label>
                <div class="input-group">
                  <div class="input-group-prepend">
                    <span class="input-group-text">R$</span>
                  </div>
                  <input maxlength="100" id="valorTotal" type="text" class="form-control valor-total-text"
                    value="{{ calcularValorTotal() }},00" disabled />
                </div>
              </div>
            </div>
            <form [formGroup]="formOrdemServico" class="col-md-12 mt-4" novalidate>
              <div>
                <div class="row">
                  <div class="col-md-2">
                    <div class="form-group">
                      <label for="kmAtual">Km Atual Veículo:</label>
                      <div class="input-group">
                        <input maxlength="100" id="kmAtual" type="number" class="form-control"
                          formControlName="KmAtual" />
                      </div>
                    </div>
                  </div>
                </div>

                <div class="form-group">
                  <label for="observacoes">Observações:</label>
                  <textarea maxlength="500" id="observacoes" class="form-control" formControlName="observacoes"
                    rows="3"></textarea>
                </div>
              </div>
            </form>



            <div class="col-md-12">
              <div class="form-group">
                <button type="submit" class="btn btn-primary" (click)="gerarOrcamento()">Gerar Orçamento</button>
              </div>
            </div>
          </div>
        </div>
        <button type="button" class="btn btn-secondary mb-2 mr-4 float-right" (click)="goBack()">
          Voltar
        </button>
      </div>
    </div>
  </section>
</div>

<!--------------------------------------------------VISUALIZAR-ORÇAMENTO-------------------------------------------------->
<div *ngIf=" tipo == 'visualizar'">
  <section>
    <div class="col-12">
      <div class="content-header">
        <h1>Visualizar de Orçamentos</h1>
      </div>
    </div>

  </section>
  <section>
    <div class="card">
      <div class="card-content">
        <div class="card-body">
          <div class="row" id="ordem-servico-cadastro">
            <div class="col-md-12 mt-4">
              <h3>Lista de Serviços</h3>
              <table class="table table-bordered">
                <thead>
                  <tr>
                    <th>Serviço</th>
                    <th>Valor (R$)</th>
                    <th>KM Atual Veiculo:</th>
                    <th>KM Serviço:</th>
                    <th>Média Km/dia:</th>


                  </tr>
                </thead>
                <tbody>
                  <!-- Use ngFor para percorrer manutenceServicos -->
                  <tr *ngFor="let servico of ordemServico.manutecesServicos">
                    <td>{{ servico.nome }}</td>
                    <td>{{ servico.valor }},00</td>
                    <td>{{ servico.kmatual }}</td>
                    <td> {{ servico.kmservico }} </td>
                    <td> {{ servico.mediakm }} </td>
                  </tr>
                </tbody>
              </table>
            </div>


            <div class="col-md-4 mt-4">
              <div class="form-group">
                <label for="valorTotal">Valor Total (R$):</label>
                <div class="input-group">
                  <div class="input-group-prepend">
                    <span class="input-group-text">R$</span>
                  </div>
                  <!-- Use vinculação de propriedade [value] para vincular o valor -->
                  <input maxlength="100" id="valorTotal" type="text" class="form-control valor-total-text"
                  [value]="ordemServico.valorTotal + ',00'" disabled />
                </div>
              </div>
            </div>
          </div>
          <button type="button" class="btn btn-primary mb-2 mr-4" (click)="gerarPDF()">Gerar PDF</button>
        </div>
        <button type="button" class="btn btn-secondary mb-2 mr-4 float-right" (click)="goBack()">
          Voltar
        </button>
      </div>
    </div>
    <div class="loading-overlay" *ngIf="showLoading">
      <div class="loading-spinner"></div>
    </div>
  </section>
</div>

<!--------------------------------------------------EDITAR-ORÇAMENTO------------------------------------------------------>
<div *ngIf=" tipo == 'editar'">
  <section>
    <div class="col-12">
      <div class="content-header">
        <h1>Editar de Orçamento</h1>
      </div>
    </div>

  </section>
  <section>
    <div class="card">
      <div class="card-content">
        <div class="card-body">
          <div class="row" id="ordem-servico-cadastro">
            <div class="col-md-12 mt-4">
              <h3>Adicionar Serviços</h3>
              <div class="col-md-3">
              </div>
              <div class="row">
                <div class="col-md-6">
                  <label for="servico">Serviço:</label>
                  <ng-select (change)="onSelectServico($event)">
                    <ng-option *ngFor="let listServicos of servicosList" [value]="listServicos.descricao">
                      {{ listServicos.descricao }}
                    </ng-option>
                  </ng-select>
                </div>
                <!-- <div class="col-md-6">
                  <div class="form-group">
                    <label for="servico">Serviço:</label>
                    <input maxlength="100" id="servico" type="text" class="form-control" [(ngModel)]="novoServico" />
                  </div>
                </div> -->
                <div class="col-md-3 align-self-end">
                  <div class="form-group">
                    <label for="valorServico">Valor do Serviço (R$):</label>
                    <div class="input-group">
                      <div class="input-group-prepend">
                        <span class="input-group-text">R$</span>
                      </div>
                      <input maxlength="100" id="valorServico" type="number" class="form-control"
                        [(ngModel)]="novoValor" />
                    </div>
                  </div>
                </div>
                <div class="col-md-1 align-self-end">
                  <div class="form-group">
                    <button type="button" class="btn btn-success mt-md-4" (click)="adicionarServico()">+</button>
                  </div>
                </div>
              </div>
              <p>
                <button class="btn btn-primary" type="button" (click)="isCollapsed = !isCollapsed"
                  [attr.aria-expanded]="!isCollapsed" aria-controls="collapseExample">
                  Cadastrar novo serviço
                </button>
              </p>
              <div [ngbCollapse]="isCollapsed" id="collapseExample">
                <form [formGroup]="formNewServico">
                  <input maxlength="100" id="cadastrarServico" type="text" formControlName="cadastrarServico"
                    class="form-control col-md-6">
                </form>
                <button type="button" class="btn btn-info mt-md-4" (click)="cadastrarServico()">Adicionar</button>
              </div>
            </div>
            <div class="col-md-12 mt-4">
              <h3>Lista de Serviços existentes</h3>
              <table class="table table-bordered">
                <thead>
                  <tr>
                    <th>Serviço</th>
                    <th>Valor (R$)</th>
                    <th>Km do Serviço</th>
                    <th>Média/dia</th>
                    <th>Ações</th>
                  </tr>
                </thead>
                <tbody>
                  <ng-container *ngFor="let servico of ordemServico.manutecesServicos; let i = index">
                    <tr>
                      <td>{{ servico.nome }}</td>
                      <td>
                        <div class="form-group">
                          <input maxlength="100" type="number" class="form-control col-md-6" [(ngModel)]="servico.valor"
                            [readonly]="editarIndices.indexOf(i) === -1" />
                        </div>
                      </td>
                      <td>
                        <div class="form-group">
                          <input maxlength="100" type="number" class="form-control col-md-6"
                            [(ngModel)]="servico.kmservico" [readonly]="editarIndices.indexOf(i) === -1"
                            (ngModelChange)="atualizarKmServico(servico, $event)" />
                        </div>
                      </td>
                      <td>
                        <div class="form-group">
                          <input maxlength="100" type="number" class="form-control col-md-6"
                            [(ngModel)]="servico.mediakm" [readonly]="editarIndices.indexOf(i) === -1"
                            (ngModelChange)="atualizarMediaKm(servico, $event)" />
                        </div>
                      </td>

                      <td>
                        <button class="btn btn-primary" (click)="toggleEdicao(i)">
                          {{ editarIndices.indexOf(i) === -1 ? 'Alterar' : 'Cancelar' }}
                        </button>
                        <button class="btn btn-success" *ngIf="editarIndices.indexOf(i) !== -1"
                          (click)="adicionarParaAlterar(servico)">
                          Salvar
                        </button>
                      </td>
                    </tr>
                  </ng-container>
                </tbody>
                <tbody>
                  <tr *ngFor="let servico of servicos">
                    <td>{{ servico.nome }}</td>
                    <td>{{ servico.valor.toFixed(2) }}</td>
                    <td>
                      <div class="form-group">
                        <input maxlength="100" type="number" class="form-control col-md-6"
                          [(ngModel)]="servico.kmServico" />
                      </div>
                    </td>
                    <td>
                      <div class="form-group">
                        <input maxlength="100" type="number" class="form-control col-md-6"
                          [(ngModel)]="servico.mediaKm" />
                      </div>
                    </td>
                    <td>
                      <button type="button" class="btn btn-danger btn-sm mr-2"
                        (click)="removerServico(servico)">Remover</button>
                      <button type="button" class="btn btn-success btn-sm mt-2"
                        (click)="salvarNovoServico(servico)">Adicionar</button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>


            <!-- Exibição dos serviços selecionados -->
            <div class="col-md-12 mt-4" *ngIf="">
              <h3>Lista de Serviços para Alterar</h3>
              <table class="table table-bordered">
                <thead>
                  <tr>
                    <th>Serviço para Alterar</th>
                    <th>Valor (R$)</th>
                    <th>Km do Serviço</th>
                    <th>Média/dia</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let servicoControl of servicosParaAlterar.controls; let i = index">
                    <td>{{ servicoControl.value.nome }}</td>
                    <td>
                      <div class="form-group">
                        <input maxlength="100" type="text" class="form-control col-md-6"
                          [formControl]="servicoControl.get('valor')" />
                      </div>
                    </td>
                    <td>
                      <div class="form-group">
                        <input maxlength="100" type="text" class="form-control col-md-6"
                          [formControl]="servicoControl.get('kmServico')" />
                      </div>
                    </td>
                    <td>
                      <div class="form-group">
                        <input maxlength="100" type="text" class="form-control col-md-6"
                          [formControl]="servicoControl.get('mediaKm')" />
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>

            <div class="col-md-4 mt-4">
              <div class="form-group">
                <label for="valorTotal">Valor Total (R$):</label>
                <div class="input-group">
                  <div class="input-group-prepend">
                    <span class="input-group-text">R$</span>
                  </div>
                  <input maxlength="100" id="valorTotal" type="text" class="form-control valor-total-text" disabled
                    [value]="valorTotal.toFixed(2)" />
                </div>
              </div>
            </div>

            <form [formGroup]="formOrdemServico" class="col-md-12 mt-4" novalidate>
              <div>
                <div class="row">
                  <div class="col-md-2">
                    <div class="form-group">
                      <label for="kmAtual">Km Atual Veículo:</label>
                      <div class="input-group">
                        <input maxlength="100" id="kmAtual" type="number" class="form-control" formControlName="KmAtual"
                          value="{{ ordemServico.kmatual }}" />
                      </div>
                    </div>
                  </div>
                </div>

                <div class="form-group">
                  <label for="observacoes">Observações:</label>
                  <textarea maxlength="500" id="observacoes" class="form-control" formControlName="observacoes" rows="3"
                    value="{{ ordemServico.observacoes }}"></textarea>
                </div>
              </div>
            </form>
          </div>
        </div>
        <button class="btn btn-primary mb-4 mr-4 float-right" type="button" (click)="editarOs()">Salvar</button>
      </div>
    </div>
    <button type="button" class="btn btn-secondary mb-2 mr-4 float-right" (click)="goBack()">
      Voltar
    </button>
  </section>
</div>
